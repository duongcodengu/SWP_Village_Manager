@model List<Village_Manager.Models.Product>
@{
    ViewData["Title"] = "Shop";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Fastkart">
    <meta name="keywords" content="Fastkart">
    <meta name="author" content="Fastkart">
    <link rel="icon" href="~/images/favicon/1.png" type="image/x-icon">
    <title>On-demand last-mile delivery</title>

    <!-- Google font -->
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Russo+One&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Exo+2:wght@400;500;600;700;800;900&display=swap"
          rel="stylesheet">
    <link rel="stylesheet"
          href="https://fonts.googleapis.com/css2?family=Public+Sans:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap">

    <!-- bootstrap css -->
    <link id="rtl-link" rel="stylesheet" type="text/css" href="~/css/vendors/bootstrap.css">

    <!-- wow css -->
    <link rel="stylesheet" href="~/css/animate.min.css">

    <!-- Iconly css -->
    <link rel="stylesheet" type="text/css" href="~/css/bulk-style.css">

    <!-- Template css -->
    <link id="color-link" rel="stylesheet" type="text/css" href="~/css/style.css">
</head>
<body>
    <!-- mobile fix menu start -->
    <div class="mobile-menu d-md-none d-block mobile-cart">
        <ul>
            <li class="active">
                <a href="index.html">
                    <i class="iconly-Home icli"></i>
                    <span>Trang chủ</span>
                </a>
            </li>
            <li class="mobile-category">
                <a href="javascript:void(0)">
                    <i class="iconly-Category icli js-link"></i>
                    <span>Danh mục</span>
                </a>
            </li>
            <li>
                <a href="search.html" class="search-box">
                    <i class="iconly-Search icli"></i>
                    <span>Tìm kiếm</span>
                </a>
            </li>
            <li>
                <a href="wishlist.html" class="notifi-wishlist">
                    <i class="iconly-Heart icli"></i>
                    <span>Danh sách ước</span>
                </a>
            </li>
            <li>
                <a href="cart.html">
                    <i class="iconly-Bag-2 icli fly-cate"></i>
                    <span>Giỏ hàng</span>
                </a>
            </li>
        </ul>
    </div>
    <!-- mobile fix menu end -->
    <!-- Breadcrumb Section Start -->
    <section class="breadcrumb-section pt-0">
        <div class="container-fluid-lg">
            <div class="row">
                <div class="col-12">
                    <div class="breadcrumb-contain">
                        <h2>Danh sách sản phẩm</h2>
                        <nav>
                            <ol class="breadcrumb mb-0">
                                <li class="breadcrumb-item">
                                    <a href="index.html">
                                        <i class="fa-solid fa-house"></i>
                                    </a>
                                </li>
                                <li class="breadcrumb-item active">Sản phẩm</li>
                            </ol>
                        </nav>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- Breadcrumb Section End -->
    <!-- Shop Section Start -->
    <section class="section-b-space shop-section">
        <div class="container-fluid-lg">
            <div class="row">
                <div class="col-custom-3">
                    <div class="left-box wow fadeInUp">
                        <div class="shop-left-sidebar">
                            <div class="back-button">
                                <h3><i class="fa-solid fa-arrow-left"></i> Back</h3>
                            </div>
                            <div class="text-center mb-4">
                                <h2 class="fw-bold">Lọc</h2>
                            </div>
                            <!-- FORM SEARCH -->
                            <div class="filter-category">
                                <!-- Tiêu đề -->
                                <div class="filter-title d-flex justify-content-between align-items-center">
                                    <h2 class="mb-0">Tìm kiếm</h2>
                                </div>
                                <div class="d-flex flex-column gap-2">
                                    <form id="searchForm" class="mb-1">
                                        <div class="position-relative">
                                            <input type="text" id="searchBox" class="form-control pe-5" placeholder="Nhập tên sản phẩm" />
                                            <button type="submit"
                                                    class="btn position-absolute end-0 top-50 translate-middle-y me-3 p-0 border-0 bg-transparent">
                                                <i class="fa fa-search text-muted"></i>
                                            </button>
                                        </div>
                                    </form>
                                    <button id="clearAllBtn" type="button"
                                            class="text-success fw-semibold border-0 bg-transparent p-0 align-self-end mt-2">
                                        Xóa lịch sử
                                    </button>
                                    <ul id="searchHistoryList" class="d-flex flex-wrap"></ul>
                                </div>
                            </div>
                            <div class="accordion custom-accordion" id="accordionExample">
                                <div class="accordion-item">
                                    <h2 class="accordion-header">
                                        <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#categoryCollapse">
                                            <span>Danh mục</span>
                                        </button>
                                    </h2>
                                    <div id="categoryCollapse" class="accordion-collapse collapse show">
                                        <div class="accordion-body">
                                            <!--Category -->
                                            @foreach (var cat in ViewBag.Categories as List<Village_Manager.Models.ProductCategory>)
                                            {
                                                var isChecked = Context.Request.Query["categoryIds"].Contains(cat.Id.ToString());
                                                <div class="form-check mb-2">
                                                    <input class="form-check-input" type="checkbox" name="categoryIds" value="@cat.Id" @(isChecked ? "checked" : "") />
                                                    <label class="form-check-label">@cat.Name</label>
                                                </div>
                                            }
                                        </div>
                                    </div>
                                    <!-- Price range-->
                                    <div class="accordion-item mt-2">
                                        <h2 class="accordion-header">
                                            <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapsePrice">
                                                <span>Khoảng giá</span>
                                            </button>
                                        </h2>
                                        <div id="collapsePrice" class="accordion-collapse collapse show">
                                            <div class="accordion-body">
                                                <div class="range-slider" style="max-width: 100%;">
                                                    <input type="text" id="price-range" name="price" value="" />
                                                    <input type="hidden" id="minPrice" name="minPrice" />
                                                    <input type="hidden" id="maxPrice" name="maxPrice" />
                                                    <div class="d-flex justify-content-between gap-2 mt-2">
                                                        <input type="text" class="form-control" id="manualMin" placeholder="Min price" />
                                                        <input type="text" class="form-control" id="manualMax" placeholder="Max price" />
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- Apply Filter-->
                                    <div class="mt-3">
                                        <button id="applyFilterBtn" class="btn w-100 fw-bold"
                                                style="background-color: #0DA487; color: white; border-radius: 6px;" type="button">
                                            Áp dụng
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-custom-">
                    <div class="show-button">
                        <div class="filter-button-group mt-0">
                            <div class="filter-button d-inline-block d-lg-none">
                                <a style="cursor: pointer;">
                                    <i class="fa-solid fa-filter"></i> Danh sách lọc
                                </a>
                            </div>
                        </div>
                        <div class="top-filter-menu">
                            <div class="category-dropdown">
                                <h5 class="text-content">Sắp xếp theo :</h5>
                                <div class="dropdown">
                                    <button class="btn dropdown-toggle" type="button" id="sortDropdownButton"
                                            data-bs-toggle="dropdown" aria-expanded="false" data-sort="">
                                        <span id="currentSortLabel">Mặc định</span>
                                        <i class="fa-solid fa-angle-down"></i>
                                    </button>
                                    <ul class="dropdown-menu" aria-labelledby="sortDropdownButton">
                                        <li><a href="javascript:void(0)" class="dropdown-item" data-sort="">Mặc định</a></li>
                                        <li><a href="javascript:void(0)" class="dropdown-item" data-sort="price_asc">Giá thấp -> cao</a></li>
                                        <li><a href="javascript:void(0)" class="dropdown-item" data-sort="price_desc">Giá cao -> thấp</a></li>
                                        <li><a href="javascript:void(0)" class="dropdown-item" data-sort="name_asc">Tên từ A -> Z</a></li>
                                        <li><a href="javascript:void(0)" class="dropdown-item" data-sort="name_desc">Tên từ Z -> A</a></li>
                                    </ul>
                                </div>
                            </div>
                            <div class="grid-option d-none d-md-block">
                                <ul>
                                    <li class="grid-btn d-xxl-inline-block d-none active">
                                        <a href="javascript:void(0)">
                                            <img src="~/svg/grid-4.svg"
                                                 class="blur-up lazyload d-lg-inline-block d-none" alt="">
                                            <img src="~/svg/grid.svg"
                                                 class="blur-up lazyload img-fluid d-lg-none d-inline-block" alt="">
                                        </a>
                                    </li>
                                    <li class="list-btn">
                                        <a href="javascript:void(0)">
                                            <img src="~/svg/list.svg" class="blur-up lazyload" alt="">
                                        </a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div id="product-list" class="row g-sm-4 g-3 row-cols-xxl-4 row-cols-xl-3 row-cols-lg-2 row-cols-md-3 row-cols-2 product-list-section">
                        @foreach (var item in Model)
                        {
                            <div class="col">
                                <div class="product-box-3 h-100 wow fadeInUp">
                                    <div class="product-header">
                                        <div class="product-image">
                                            <a href="/shop/detail/@item.Id">
                                                <img src="@(item.ProductImages.FirstOrDefault()?.ImageUrl ?? "/images/product/default-product.png")"
                                                     class="img-fluid blur-up lazyload" alt="@item.Name" />
                                            </a>
                                        </div>
                                    </div>
                                    <div class="product-footer">
                                        <div class="product-detail">
                                            <span class="span-name">@item.Category?.Name</span>
                                            <a href="/shop/detail/@item.Id" class="name theme-color">@item.Name</a>
                                            <p class="text-content mt-1 mb-2 product-content">Tình trạng: @item.ProductType</p>
                                            <h5 class="price text-dark">₫@item.Price.ToString("N0")</h5>
                                            <!-- Nút Add to Cart -->
                                            <div class="cart_qty qty-box open mt-2">
                                                <form method="post" asp-controller="Shop" asp-action="AddToCart" class="d-flex align-items-center">
                                                    <input type="hidden" name="productId" value="@item.Id" />
                                                    <div class="input-group bg-white w-auto">
                                                        <button type="button" onclick="adjustQty(this, -1)"><i class="fa fa-minus"></i></button>
                                                        <input type="number" name="quantity" class="form-control input-number qty-input text-center" value="1" min="1" />
                                                        <button type="button" onclick="adjustQty(this, 1)"><i class="fa fa-plus"></i></button>
                                                    </div>
                                                    <script>
                                                        function adjustQty(btn, delta) {
                                                            const input = btn.parentElement.querySelector('.qty-input');
                                                            let val = parseInt(input.value) || 1;
                                                            val += delta;
                                                            if (val < 1) val = 1;
                                                            input.value = val;
                                                        }
                                                    </script>
                                                    <button type="submit" class="btn btn-sm ms-2" style="background-color: #4caf50; color: white;">
                                                        <i class="fa fa-shopping-cart"></i>
                                                    </button>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        }
                    </div>
                    <nav class="custom-pagination">
                        <ul class="pagination justify-content-center">
                            <li class="page-item disabled">
                                <a class="page-link" href="javascript:void(0)" tabindex="-1">
                                    <i class="fa-solid fa-angles-left"></i>
                                </a>
                            </li>
                            <li class="page-item active">
                                <a class="page-link" href="javascript:void(0)">1</a>
                            </li>
                            <li class="page-item">
                                <a class="page-link" href="javascript:void(0)">2</a>
                            </li>
                            <li class="page-item">
                                <a class="page-link" href="javascript:void(0)">3</a>
                            </li>
                            <li class="page-item">
                                <a class="page-link" href="javascript:void(0)">
                                    <i class="fa-solid fa-angles-right"></i>
                                </a>
                            </li>
                        </ul>
                    </nav>
                </div>
            </div>
        </div>
    </section>
    <!-- Shop Section End -->
    <!-- Footer Section Start -->
    <footer class="section-t-space">
        <div class="container-fluid-lg">
            <div class="service-section">
                <div class="row g-3">
                    <div class="col-12">
                        <div class="service-contain">
                            <div class="service-box">
                                <div class="service-image">
                                    <img src="~/svg/product.svg" class="blur-up lazyload" alt="">
                                </div>
                                <div class="service-detail">
                                    <h5>Every Fresh Products</h5>
                                </div>
                            </div>
                            <div class="service-box">
                                <div class="service-image">
                                    <img src="~/svg/delivery.svg" class="blur-up lazyload" alt="">
                                </div>
                                <div class="service-detail">
                                    <h5>Free Delivery For Order Over $50</h5>
                                </div>
                            </div>
                            <div class="service-box">
                                <div class="service-image">
                                    <img src="~/svg/discount.svg" class="blur-up lazyload" alt="">
                                </div>
                                <div class="service-detail">
                                    <h5>Daily Mega Discounts</h5>
                                </div>
                            </div>
                            <div class="service-box">
                                <div class="service-image">
                                    <img src="~/svg/market.svg" class="blur-up lazyload" alt="">
                                </div>
                                <div class="service-detail">
                                    <h5>Best Price On The Market</h5>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="main-footer section-b-space section-t-space">
                <div class="row g-md-4 g-3">
                    <div class="col-xl-3 col-lg-4 col-sm-6">
                        <div class="footer-logo">
                            <div class="theme-logo">
                                <a href="index.html">
                                    <img src="~/images/logo/1.png" class="blur-up lazyload" alt="">
                                </a>
                            </div>
                            <div class="footer-logo-contain">
                                <p>
                                    We are a friendly bar serving a variety of cocktails, wines and beers. Our bar is a
                                    perfect place for a couple.
                                </p>
                                <ul class="address">
                                    <li>
                                        <i data-feather="home"></i>
                                        <a href="javascript:void(0)">1418 Riverwood Drive, CA 96052, US</a>
                                    </li>
                                    <li>
                                        <i data-feather="mail"></i>
                                        <a href="javascript:void(0)">support@fastkart.com</a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-2 col-lg-3 col-md-4 col-sm-6">
                        <div class="footer-title">
                            <h4>Categories</h4>
                        </div>
                        <div class="footer-contain">
                            <ul>
                                <li>
                                    <a href="shop-left-sidebar.html" class="text-content">Vegetables & Fruit</a>
                                </li>
                                <li>
                                    <a href="shop-left-sidebar.html" class="text-content">Beverages</a>
                                </li>
                                <li>
                                    <a href="shop-left-sidebar.html" class="text-content">Meats & Seafood</a>
                                </li>
                                <li>
                                    <a href="shop-left-sidebar.html" class="text-content">Frozen Foods</a>
                                </li>
                                <li>
                                    <a href="shop-left-sidebar.html" class="text-content">Biscuits & Snacks</a>
                                </li>
                                <li>
                                    <a href="shop-left-sidebar.html" class="text-content">Grocery & Staples</a>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div class="col-xl col-lg-2 col-sm-3">
                        <div class="footer-title">
                            <h4>Useful Links</h4>
                        </div>
                        <div class="footer-contain">
                            <ul>
                                <li>
                                    <a href="index.html" class="text-content">Home</a>
                                </li>
                                <li>
                                    <a href="shop-left-sidebar.html" class="text-content">Shop</a>
                                </li>
                                <li>
                                    <a href="about-us.html" class="text-content">About Us</a>
                                </li>
                                <li>
                                    <a href="blog-list.html" class="text-content">Blog</a>
                                </li>
                                <li>
                                    <a href="contact-us.html" class="text-content">Contact Us</a>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div class="col-xl-2 col-sm-3">
                        <div class="footer-title">
                            <h4>Help Center</h4>
                        </div>
                        <div class="footer-contain">
                            <ul>
                                <li>
                                    <a href="order-success.html" class="text-content">Your Order</a>
                                </li>
                                <li>
                                    <a href="user-dashboard.html" class="text-content">Your Account</a>
                                </li>
                                <li>
                                    <a href="order-tracking.html" class="text-content">Track Order</a>
                                </li>
                                <li>
                                    <a href="wishlist.html" class="text-content">Your Wishlist</a>
                                </li>
                                <li>
                                    <a href="search.html" class="text-content">Search</a>
                                </li>
                                <li>
                                    <a href="faq.html" class="text-content">FAQ</a>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div class="col-xl-3 col-lg-4 col-sm-6">
                        <div class="footer-title">
                            <h4>Contact Us</h4>
                        </div>
                        <div class="footer-contact">
                            <ul>
                                <li>
                                    <div class="footer-number">
                                        <i data-feather="phone"></i>
                                        <div class="contact-number">
                                            <h6 class="text-content">Hotline 24/7 :</h6>
                                            <h5>+91 888 104 2340</h5>
                                        </div>
                                    </div>
                                </li>
                                <li>
                                    <div class="footer-number">
                                        <i data-feather="mail"></i>
                                        <div class="contact-number">
                                            <h6 class="text-content">Email Address :</h6>
                                            <h5>fastkart@hotmail.com</h5>
                                        </div>
                                    </div>
                                </li>
                                <li class="social-app">
                                    <h5 class="mb-2 text-content">Download App :</h5>
                                    <ul>
                                        <li class="mb-0">
                                            <a href="https://play.google.com/store/apps" target="_blank">
                                                <img src="~/images/playstore.svg" class="blur-up lazyload"
                                                     alt="">
                                            </a>
                                        </li>
                                        <li class="mb-0">
                                            <a href="https://www.apple.com/in/app-store/" target="_blank">
                                                <img src="~/images/appstore.svg" class="blur-up lazyload"
                                                     alt="">
                                            </a>
                                        </li>
                                    </ul>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="sub-footer section-small-space">
                <div class="reserve">
                    <h6 class="text-content">©2022 Fastkart All rights reserved</h6>
                </div>
                <div class="payment">
                    <img src="~/images/payment/1.png" class="blur-up lazyload" alt="">
                </div>
                <div class="social-link">
                    <h6 class="text-content">Stay connected :</h6>
                    <ul>
                        <li>
                            <a href="https://www.facebook.com/" target="_blank">
                                <i class="fa-brands fa-facebook-f"></i>
                            </a>
                        </li>
                        <li>
                            <a href="https://twitter.com/" target="_blank">
                                <i class="fa-brands fa-twitter"></i>
                            </a>
                        </li>
                        <li>
                            <a href="https://www.instagram.com/" target="_blank">
                                <i class="fa-brands fa-instagram"></i>
                            </a>
                        </li>
                        <li>
                            <a href="https://in.pinterest.com/" target="_blank">
                                <i class="fa-brands fa-pinterest-p"></i>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </footer>
    <!-- Footer Section End -->
    <!-- Quick View Modal Box Start -->
    <div class="modal fade theme-modal view-modal" id="view" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered modal-xl modal-fullscreen-sm-down">
            <div class="modal-content">
                <div class="modal-header p-0">
                    <button type="button" class="btn-close" data-bs-dismiss="modal">
                        <i class="fa-solid fa-xmark"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="row g-sm-4 g-2">
                        <div class="col-lg-6">
                            <div class="slider-image">
                                <img src="~/images/product/category/1.jpg" class="img-fluid blur-up lazyload"
                                     alt="">
                            </div>
                        </div>
                        <div class="col-lg-6">
                            <div class="right-sidebar-modal">
                                <h4 class="title-name">Peanut Butter Bite Premium Butter Cookies 600 g</h4>
                                <h4 class="price">$36.99</h4>
                                <div class="product-rating">
                                    <ul class="rating">
                                        <li>
                                            <i data-feather="star" class="fill"></i>
                                        </li>
                                        <li>
                                            <i data-feather="star" class="fill"></i>
                                        </li>
                                        <li>
                                            <i data-feather="star" class="fill"></i>
                                        </li>
                                        <li>
                                            <i data-feather="star" class="fill"></i>
                                        </li>
                                        <li>
                                            <i data-feather="star"></i>
                                        </li>
                                    </ul>
                                    <span class="ms-2">8 Reviews</span>
                                    <span class="ms-2 text-danger">6 sold in last 16 hours</span>
                                </div>
                                <div class="product-detail">
                                    <h4>Product Details :</h4>
                                    <p>
                                        Candy canes sugar plum tart cotton candy chupa chups sugar plum chocolate I love.
                                        Caramels marshmallow icing dessert candy canes I love soufflé I love toffee.
                                        Marshmallow pie sweet sweet roll sesame snaps tiramisu jelly bear claw. Bonbon
                                        muffin I love carrot cake sugar plum dessert bonbon.
                                    </p>
                                </div>
                                <ul class="brand-list">
                                    <li>
                                        <div class="brand-box">
                                            <h5>Brand Name:</h5>
                                            <h6>Black Forest</h6>
                                        </div>
                                    </li>
                                    <li>
                                        <div class="brand-box">
                                            <h5>Product Code:</h5>
                                            <h6>W0690034</h6>
                                        </div>
                                    </li>
                                    <li>
                                        <div class="brand-box">
                                            <h5>Product Type:</h5>
                                            <h6>White Cream Cake</h6>
                                        </div>
                                    </li>
                                </ul>
                                <div class="select-size">
                                    <h4>Cake Size :</h4>
                                    <select class="form-select select-form-size">
                                        <option selected>Select Size</option>
                                        <option value="1.2">1/2 KG</option>
                                        <option value="0">1 KG</option>
                                        <option value="1.5">1/5 KG</option>
                                        <option value="red">Red Roses</option>
                                        <option value="pink">With Pink Roses</option>
                                    </select>
                                </div>
                                <div class="modal-button">
                                    <button onclick="location.href = 'cart.html';"
                                            class="btn btn-md add-cart-button icon">
                                        Add
                                        To Cart
                                    </button>
                                    <button onclick="location.href = 'product-left-thumbnail.html';"
                                            class="btn theme-bg-color view-button icon text-white fw-bold btn-md">
                                        View More Details
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Quick View Modal Box End -->
    <!-- Location Modal Start -->
    <div class="modal location-modal fade theme-modal" id="locationModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered modal-fullscreen-sm-down">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Choose your Delivery Location</h5>
                    <p class="mt-1 text-content">Enter your address and we will specify the offer for your area.</p>
                    <button type="button" class="btn-close" data-bs-dismiss="modal">
                        <i class="fa-solid fa-xmark"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="location-list">
                        <div class="search-input">
                            <input type="search" class="form-control" placeholder="Search Your Area">
                            <i class="fa-solid fa-magnifying-glass"></i>
                        </div>
                        <div class="disabled-box">
                            <h6>Select a Location</h6>
                        </div>
                        <ul class="location-select custom-height">
                            <li>
                                <a href="javascript:void(0)">
                                    <h6>Alabama</h6>
                                    <span>Min: $130</span>
                                </a>
                            </li>
                            <li>
                                <a href="javascript:void(0)">
                                    <h6>Arizona</h6>
                                    <span>Min: $150</span>
                                </a>
                            </li>
                            <li>
                                <a href="javascript:void(0)">
                                    <h6>California</h6>
                                    <span>Min: $110</span>
                                </a>
                            </li>
                            <li>
                                <a href="javascript:void(0)">
                                    <h6>Colorado</h6>
                                    <span>Min: $140</span>
                                </a>
                            </li>
                            <li>
                                <a href="javascript:void(0)">
                                    <h6>Florida</h6>
                                    <span>Min: $160</span>
                                </a>
                            </li>
                            <li>
                                <a href="javascript:void(0)">
                                    <h6>Georgia</h6>
                                    <span>Min: $120</span>
                                </a>
                            </li>
                            <li>
                                <a href="javascript:void(0)">
                                    <h6>Kansas</h6>
                                    <span>Min: $170</span>
                                </a>
                            </li>
                            <li>
                                <a href="javascript:void(0)">
                                    <h6>Minnesota</h6>
                                    <span>Min: $120</span>
                                </a>
                            </li>
                            <li>
                                <a href="javascript:void(0)">
                                    <h6>New York</h6>
                                    <span>Min: $110</span>
                                </a>
                            </li>
                            <li>
                                <a href="javascript:void(0)">
                                    <h6>Washington</h6>
                                    <span>Min: $130</span>
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Location Modal End -->
    <!-- Deal Box Modal Start -->
    <div class="modal fade theme-modal deal-modal" id="deal-box" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered modal-fullscreen-sm-down">
            <div class="modal-content">
                <div class="modal-header">
                    <div>
                        <h5 class="modal-title w-100" id="deal_today">Deal Today</h5>
                        <p class="mt-1 text-content">Recommended deals for you.</p>
                    </div>
                    <button type="button" class="btn-close" data-bs-dismiss="modal">
                        <i class="fa-solid fa-xmark"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="deal-offer-box">
                        <ul class="deal-offer-list">
                            <li class="list-1">
                                <div class="deal-offer-contain">
                                    <a href="shop-left-sidebar.html" class="deal-image">
                                        <img src="~/images/vegetable/product/10.png" class="blur-up lazyload"
                                             alt="">
                                    </a>
                                    <a href="shop-left-sidebar.html" class="deal-contain">
                                        <h5>Blended Instant Coffee 50 g Buy 1 Get 1 Free</h5>
                                        <h6>$52.57 <del>57.62</del> <span>500 G</span></h6>
                                    </a>
                                </div>
                            </li>
                            <li class="list-2">
                                <div class="deal-offer-contain">
                                    <a href="shop-left-sidebar.html" class="deal-image">
                                        <img src="~/images/vegetable/product/11.png" class="blur-up lazyload"
                                             alt="">
                                    </a>
                                    <a href="shop-left-sidebar.html" class="deal-contain">
                                        <h5>Blended Instant Coffee 50 g Buy 1 Get 1 Free</h5>
                                        <h6>$52.57 <del>57.62</del> <span>500 G</span></h6>
                                    </a>
                                </div>
                            </li>
                            <li class="list-3">
                                <div class="deal-offer-contain">
                                    <a href="shop-left-sidebar.html" class="deal-image">
                                        <img src="~/images/vegetable/product/12.png" class="blur-up lazyload"
                                             alt="">
                                    </a>
                                    <a href="shop-left-sidebar.html" class="deal-contain">
                                        <h5>Blended Instant Coffee 50 g Buy 1 Get 1 Free</h5>
                                        <h6>$52.57 <del>57.62</del> <span>500 G</span></h6>
                                    </a>
                                </div>
                            </li>
                            <li class="list-1">
                                <div class="deal-offer-contain">
                                    <a href="shop-left-sidebar.html" class="deal-image">
                                        <img src="~/images/vegetable/product/13.png" class="blur-up lazyload"
                                             alt="">
                                    </a>
                                    <a href="shop-left-sidebar.html" class="deal-contain">
                                        <h5>Blended Instant Coffee 50 g Buy 1 Get 1 Free</h5>
                                        <h6>$52.57 <del>57.62</del> <span>500 G</span></h6>
                                    </a>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Deal Box Modal End -->
    <!-- Add to cart Modal Start -->
    <div class="add-cart-box">
        <div class="add-image">
            <img src="~/images/cake/pro/1.jpg" class="img-fluid blur-up lazyload" alt="">
        </div>
        <div class="add-contain">
            <h6>Added to Cart</h6>
        </div>
    </div>
    <!-- Add to cart Modal End -->
    <!-- Tap to top and theme setting button start -->
    <div class="theme-option">
        <div class="setting-box">
            <button class="btn setting-button">
                <i class="fa-solid fa-gear"></i>
            </button>

            <div class="theme-setting-2">
                <div class="theme-box">
                    <ul>
                        <li>
                            <div class="setting-name">
                                <h4>Color</h4>
                            </div>
                            <div class="theme-setting-button color-picker">
                                <form class="form-control">
                                    <label for="colorPick" class="form-label mb-0">Theme Color</label>
                                    <input type="color" class="form-control form-control-color" id="colorPick"
                                           value="#0da487" title="Choose your color">
                                </form>
                            </div>
                        </li>

                        <li>
                            <div class="setting-name">
                                <h4>Dark</h4>
                            </div>
                            <div class="theme-setting-button">
                                <button class="btn btn-2 outline" id="darkButton">Dark</button>
                                <button class="btn btn-2 unline" id="lightButton">Light</button>
                            </div>
                        </li>

                        <li>
                            <div class="setting-name">
                                <h4>RTL</h4>
                            </div>
                            <div class="theme-setting-button rtl">
                                <button class="btn btn-2 rtl-unline">LTR</button>
                                <button class="btn btn-2 rtl-outline">RTL</button>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="back-to-top">
            <a id="back-to-top" href="#">
                <i class="fas fa-chevron-up"></i>
            </a>
        </div>
    </div>
    <!-- Tap to top and theme setting button end -->
    <!-- Bg overlay Start -->
    <div class="bg-overlay"></div>
    <!-- Bg overlay End -->
    <!-- latest jquery-->
    <script src="~/js/jquery-3.6.0.min.js"></script>

    <!-- jquery ui-->
    <script src="~/js/jquery-ui.min.js"></script>

    <!-- Bootstrap js-->
    <script src="~/js/bootstrap/bootstrap.bundle.min.js"></script>
    <script src="~/js/bootstrap/bootstrap-notify.min.js"></script>
    <script src="~/js/bootstrap/popper.min.js"></script>

    <!-- feather icon js-->
    <script src="~/js/feather/feather.min.js"></script>
    <script src="~/js/feather/feather-icon.js"></script>

    <!-- Lazyload Js -->
    <script src="~/js/lazysizes.min.js"></script>

    <!-- Slick js-->
    <script src="~/js/slick/slick.js"></script>
    <script src="~/js/slick/slick-animation.min.js"></script>
    <script src="~/js/slick/custom_slick.js"></script>

    <!-- Price Range Js -->
    <script src="~/js/ion.rangeSlider.min.js"></script>

    <!-- Quantity js -->
    <script src="~/js/quantity-2.js"></script>

    <!-- sidebar open js -->
    <script src="~/js/filter-sidebar.js"></script>

    <!-- WOW js -->
    <script src="~/js/wow.min.js"></script>
    <script src="~/js/custom-wow.js"></script>

    <!-- script js -->
    <script src="~/js/script.js"></script>

    <!-- theme setting js -->
    <script src="~/js/theme-setting.js"></script>

    <script>
        $(document).ready(function () {

            // ===== 1. Gọi API tìm kiếm sản phẩm =====
            window.fetchProducts = function () {
                const search = $("#searchBox").val()?.trim();
                const sort = $("#sortDropdownButton").data("sort") || "";
                const minPrice = $("#minPrice").val();
                const maxPrice = $("#maxPrice").val();
                const categoryIds = $("input[name='categoryIds']:checked").map(function () {
                    return $(this).val();
                }).get();

                $.ajax({
                    url: "/api/shopapi/products",
                    data: {
                        search: search,
                        categoryIds: categoryIds,
                        minPrice: minPrice,
                        maxPrice: maxPrice,
                        sort: sort
                    },
                    traditional: true,
                    success: function (data) {
                        window.renderProducts(data);
                    },
                    error: function (xhr) {
                        console.error("API lỗi:", xhr.responseText);
                    }
                });
            };

            // ===== 2. Hiển thị danh sách sản phẩm =====
            window.renderProducts = function (products) {
                const container = $("#product-list");
                container.empty();

                if (products.length === 0) {
                    container.append("<p>No products found.</p>");
                    return;
                }

                products.forEach(p => {
                    const imageUrl = p.image || "/images/product/default-product.png";
                    const price = Number(p.price).toLocaleString();
                    const category = p.categoryName || "";

                    const html = `
                        <div class="col">
                            <div class="product-box-3 h-100 wow fadeInUp">
                                <div class="product-header">
                                    <div class="product-image">
                                        <a href="/shop/detail/${p.id}">
                                            <img src="${imageUrl}"
                                                 onerror="this.onerror=null;this.src='/images/product/default-product.png';"
                                                 class="img-fluid blur-up lazyload" alt="${p.name}" />
                                        </a>
                                    </div>
                                </div>
                                <div class="product-footer">
                                    <div class="product-detail">
                                        <span class="span-name">${category}</span>
                                        <a href="/shop/detail/${p.id}" class="name theme-color">${p.name}</a>
                                        <p class="text-content mt-1 mb-2 product-content">Tình trạng: ${p.productType}</p>
                                        <h5 class="price text-dark">₫${price}</h5>
                                        <div class="cart_qty qty-box open mt-2">
                                            <div class="d-flex align-items-center">
                                                <input type="hidden" class="product-id" value="${p.id}" />
                                                <div class="input-group bg-white w-auto">
                                                    <button type="button" onclick="adjustQty(this, -1)">
                                                        <i class="fa fa-minus"></i>
                                                    </button>
                                                    <input type="number" class="form-control input-number qty-input text-center" value="1" min="1" />
                                                    <button type="button" onclick="adjustQty(this, 1)">
                                                        <i class="fa fa-plus"></i>
                                                    </button>
                                                </div>
                                                <button type="button" class="btn btn-sm ms-2 text-white" style="background-color: #4caf50;" onclick="handleAddToCart(this)">
                                                    <i class="fa fa-shopping-cart"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>`;
                    container.append(html);
                });
            };

            // ===== 3. Lưu từ khóa tìm kiếm vào lịch sử =====
            window.saveSearchHistory = function (keyword) {
                let history = JSON.parse(sessionStorage.getItem("SearchHistory") || "[]");
                if (!history.includes(keyword)) {
                    history.push(keyword);
                    sessionStorage.setItem("SearchHistory", JSON.stringify(history));
                }
                window.renderSearchHistory();
            };

            // ===== 4. Hiển thị lịch sử tìm kiếm =====
            window.renderSearchHistory = function () {
                const container = $("#searchHistoryList");
                container.empty();
                const history = JSON.parse(sessionStorage.getItem("SearchHistory") || "[]");

                if (history.length === 0) {
                    container.addClass("d-none");
                    return;
                }

                container.removeClass("d-none");
                history.forEach(keyword => {
                    const li = `
                        <li style="position: relative; padding-right: 30px;">
                            <span class="keyword-item fw-semibold" data-key="${keyword}" style="cursor:pointer;">
                                ${keyword}
                            </span>
                            <button class="btn-remove-keyword border-0 bg-transparent text-muted fw-bold"
                                    data-key="${keyword}"
                                    style="position:absolute;right:0;top:50%;transform:translateY(-50%);cursor:pointer;width:24px;height:24px;display:flex;align-items:center;justify-content:center">
                            </button>
                        </li>`;
                    container.append(li);
                });
            };

            // ===== 5. Khởi tạo thanh kéo giá =====
        $(document).ready(function () {
            let from = parseInt('@Context.Request.Query["minPrice"]' || "0");
            let to = parseInt('@Context.Request.Query["maxPrice"]' || "1000000");

            // Khởi tạo slider
            $("#price-range").ionRangeSlider({
                type: "double",
                min: 0,
                max: 1000000,
                from: from,
                to: to,
                prefix: "₫ ",
                prettify_separator: ".",
                decorate_both: true,
                values_separator: " - ",
                onStart: function (data) {
                    setTimeout(adjustSliderPosition, 100);
                },
                onChange: function (data) {
                    adjustSliderPosition();
                },
                onFinish: function (data) {
                    let minPrice = Math.min(data.from, 1000000);
                    let maxPrice = Math.min(data.to, 1000000);

                    $("#minPrice").val(minPrice);
                    $("#maxPrice").val(maxPrice);

                    $("#manualMin").val(formatNumber(minPrice));
                    $("#manualMax").val(formatNumber(maxPrice));

                    adjustSliderPosition();
                }
            });

            const priceSlider = $("#price-range").data("ionRangeSlider");

            function formatNumber(num) {
                return Number(num).toLocaleString("vi-VN");
            }

            function parseFormatted(val) {
                return parseInt((val || "").toString().replaceAll(".", "")) || 0;
            }

            // Cập nhật giá trị khi nhập tay vào các input
            $("#manualMin, #manualMax").on("input", function () {
                const minVal = parseFormatted($("#manualMin").val());
                const maxVal = parseFormatted($("#manualMax").val());

                const maxLimit = 1000000;

                let minClamped = Math.min(minVal, maxLimit);
                let maxClamped = Math.min(maxVal, maxLimit);

                // Cập nhật slider nếu giá trị hợp lệ
                if (minClamped <= maxClamped) {
                    priceSlider.update({
                        from: minClamped,
                        to: maxClamped
                    });

                    // Cập nhật giá trị cho input ẩn
                    $("#minPrice").val(minClamped);
                    $("#maxPrice").val(maxClamped);
                }
            });

            // Khi người dùng rời khỏi ô nhập (blur), format lại giá trị
            $("#manualMin, #manualMax").on("blur", function () {
                let val = parseFormatted($(this).val());
                if (val > 1000000) val = 1000000;
                $(this).val(formatNumber(val));  // Hiển thị lại giá trị với dấu chấm
            });

            // Hàm điều chỉnh vị trí thanh slider khi kéo (cản lại khi chạm viền)
            function adjustSliderPosition() {
                const sliderWidth = $(".irs").width();
                const maxPosition = $(".irs-to").position().left + $(".irs-to").outerWidth();
                const minPosition = $(".irs-from").position().left;

                // Nếu giá trị max vượt quá chiều rộng của slider, dừng lại
                if (maxPosition > sliderWidth) {
                    const maxLeft = sliderWidth - $(".irs-to").outerWidth();
                    $(".irs-to").css("left", maxLeft);
                }

                // Nếu giá trị min vượt quá viền trái, dừng lại
                if (minPosition < 0) {
                    $(".irs-from").css("left", 0);
                }
            }

            // Điều chỉnh lại slider khi thay đổi kích thước cửa sổ
            $(window).resize(function () {
                setTimeout(adjustSliderPosition, 100); // Trì hoãn để điều chỉnh đúng vị trí khi cửa sổ thay đổi
            });
        });

            // ===== 6. Các xử lý sự kiện UI =====
            $("#searchForm").submit(function (e) {
                e.preventDefault();
                const keyword = $("#searchBox").val()?.trim();
                if (keyword) {
                    window.saveSearchHistory(keyword);
                    $("#searchBox").val(keyword);
                }
                window.fetchProducts();
            });

            $(document).on("click", ".search-keyword", function () {
                const keyword = $(this).data("key");
                $("#searchBox").val(keyword);
                window.fetchProducts();
            });

            $(document).on("click", ".btn-remove-keyword", function () {
                const key = $(this).data("key");
                let history = JSON.parse(sessionStorage.getItem("SearchHistory") || "[]");
                history = history.filter(k => k !== key);
                sessionStorage.setItem("SearchHistory", JSON.stringify(history));
                window.renderSearchHistory();
            });

            $("#clearAllBtn").click(function () {
                sessionStorage.removeItem("SearchHistory");
                window.renderSearchHistory();
            });

            $(".dropdown-menu .dropdown-item").click(function () {
                const label = $(this).text();
                const sort = $(this).data("sort");
                $("#currentSortLabel").text(label);
                $("#sortDropdownButton").data("sort", sort);
                window.fetchProducts();
            });

            $("#applyFilterBtn").click(function () {
                window.fetchProducts();
            });

            // ===== 7. Khởi chạy ban đầu =====
            window.renderSearchHistory();
            window.fetchProducts();

        });
    </script>
    <script>
        window.handleAddToCart = function(btn) {
            // Lấy id sản phẩm và số lượng
            const productId = $(btn).closest('.cart_qty').find('.product-id').val();
            const quantity = $(btn).closest('.cart_qty').find('.qty-input').val() || 1;

            $.ajax({
                url: '/Shop/AddToCart',
                type: 'POST',
                data: {
                    productId: productId,
                    quantity: quantity
                },
                success: function(res) {
                    // Reload lại trang hoặc fetch lại sản phẩm
                    location.reload();
                },
                error: function(xhr) {
                    alert('Add to cart failed!');
                }
            });
        };
    </script>
</body>
</html>