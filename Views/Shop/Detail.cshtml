@model Village_Manager.Models.Product
@{
    ViewData["Title"] = "Chi tiết";
    Layout = "~/Views/Shared/_Layout.cshtml";
    ViewBag.Title = Model.Name;
   
    var relatedProducts = ViewBag.RelatedProducts as List<Village_Manager.Models.Product>;
}



<!DOCTYPE html>
<html lang="vi">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="FamViệt">
    <meta name="keywords" content="FamViệt">
    <meta name="author" content="FamViệt">
    <link rel="icon" href="~/images/favicon/1.png" type="image/x-icon">
    <title>Chi tiết sản phẩm</title>

    <!-- Google font -->
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Russo+One&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Exo+2:wght@400;500;600;700;800;900&display=swap"
          rel="stylesheet">
    <link rel="stylesheet"
          href="https://fonts.googleapis.com/css2?family=Public+Sans:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap">

    <!-- bootstrap css -->
    <link id="rtl-link" rel="stylesheet" type="text/css" href="~/css/vendors/bootstrap.css">

    <!-- wow css -->
    <link rel="stylesheet" href="~/css/animate.min.css">

    <!-- Iconly css -->
    <link rel="stylesheet" type="text/css" href="~/css/bulk-style.css">

    <!-- Template css -->
    <link id="color-link" rel="stylesheet" type="text/css" href="~/css/style.css">
</head>

<body>
    <!-- Product Left Sidebar Start -->
    <section class="product-section">
        <div class="container-fluid-lg">
            <div class="row">
                <div class="col-xxl-9 col-xl-8 col-lg-7 wow fadeInUp">
                    <div class="row g-4">
                        <div class="col-xl-6 wow fadeInUp">
                            <div class="product-left-box">
                                <div class="row g-2">
                                    <div class="col-xxl-10 col-lg-12 col-md-10 order-xxl-2 order-lg-1 order-md-2">
                                        <!-- Hiển thị ảnh động từ DB -->
                                        <div class="product-main-2 no-arrow">
                                            @if (Model.ProductImages != null && Model.ProductImages.Any())
                                            {
                                                int index = 0;
                                                foreach (var image in Model.ProductImages)
                                                {
                                                    <div>
                                                        <div class="slider-image">
                                                            <img src="@image.ImageUrl"
                                                                 id="img-@index"
                                                                 data-zoom-image="@image.ImageUrl"
                                                                 class="img-fluid image_zoom_cls-@index blur-up lazyload"
                                                                 alt="@image.Description" />
                                                        </div>
                                                    </div>
                                                    index++;
                                                }
                                            }
                                            else
                                            {
                                                <div>
                                                    <div class="slider-image">
                                                        <img src="~/images/no-image.png"
                                                             class="img-fluid blur-up lazyload"
                                                             alt="No image available" />
                                                    </div>
                                                </div>
                                            }
                                        </div>
                                    </div>
                                    @* chỗ để nhiều ảnh *@
                                    <div class="col-xxl-2 col-lg-12 col-md-2 order-xxl-1 order-lg-2 order-md-1">
                                        <div class="left-slider-image-2 left-slider no-arrow slick-top">
                                           
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-xl-6 wow fadeInUp" data-wow-delay="0.1s">
                            <div class="right-box-contain">
                                <h6 class="offer-top">RẺ-CHẤT LƯỢNG</h6>
                                <h2 class="name">@Model.Name</h2>

                                <div class="price-rating">
                                    <h3 class="theme-color price">
                                        @Model.Price.ToString("N0") VND
                                        @* @if (Model.Price > 0)
                                        {
                                            <del class="text-content">@((Model.Price + 10000).ToString("N0")) VND</del>
                                            <span class="offer theme-color">(Giảm giá!)</span>
                                        } *@
                                    </h3>
                                </div>

                                <div class="product-contain">
                                    <p>
                                        Loại: @Model.ProductType <br />
                                        Số lượng: @Model.Quantity <br />
                                        Ngày hết hạn: @(Model.ExpirationDate?.ToString("dd/MM/yyyy") ?? "Không có") <br />
                                        Danh mục: @Model.Category?.Name <br />
                                    </p>
                                </div>

                                <form asp-action="AddToCart" asp-controller="Shop" method="post">
                                    <input type="hidden" name="productId" value="@Model.Id" />

                                    <div class="note-box product-package text-center">
                                        <!-- Tăng giảm số lượng -->
                                        <div class="cart_qty qty-box product-qty mb-3">
                                            <div class="d-flex justify-content-center align-items-center gap-2">
                                                <!-- Nút giảm -->
                                                <button type="button" class="btn btn-outline-dark qty-left-minus px-3">
                                                    <i class="fa fa-minus"></i>
                                                </button>

                                                <!-- Input số lượng -->
                                                <input class="form-control text-center qty-input"
                                                       type="number"
                                                       name="quantity"
                                                       value="1"
                                                       min="1"
                                                       max="@Model.Quantity"
                                                       style="width: 80px;" />

                                                <!-- Nút tăng -->
                                                <button type="button" class="btn btn-outline-dark qty-right-plus px-3">
                                                    <i class="fa fa-plus"></i>
                                                </button>
                                            </div>
                                        </div>

                                        <!-- Nút Add To Cart nằm dưới -->
                                        <button type="submit" class="btn btn-md bg-dark cart-button text-white w-100">
                                            <i class="fas fa-shopping-cart me-1"></i> Cho vào giỏ hàng
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>

                        <div class="col-12">
                            <div class="product-section-box">
                                <ul class="nav nav-tabs custom-nav" id="myTab" role="tablist">
                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link active" id="description-tab" data-bs-toggle="tab"
                                                data-bs-target="#description" type="button" role="tab">
                                           Mô Tả
                                        </button>
                                    </li>

                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link" id="info-tab" data-bs-toggle="tab"
                                                data-bs-target="#info" type="button" role="tab">
                                            Thông Tin Chi Tiết
                                        </button>
                                    </li>
                                </ul>

                                <div class="tab-content custom-tab" id="myTabContent">
                                    <div class="tab-pane fade show active" id="description" role="tabpanel">
                                        <div class="product-description">
                                            @if (Model.ProductImages != null && Model.ProductImages.Any())
                                            {
                                                foreach (var img in Model.ProductImages)
                                                {
                                                    <p>@img.Description</p>
                                                }
                                            }
                                            else
                                            {
                                                <p class="text-muted">Không có mô tả.</p>
                                            }

                                            


                                            <div class="nav-desh">
                                                <div class="desh-title">
                                                    <h5>Từ Kho Thảo Nguyen Xanh:</h5>
                                                </div>
                                                <p>
                                                    Chào mừng bạn đến với cửa hàng nông sản sạch của chúng tôi – nơi mang đến những loại hoa quả tươi ngon, an toàn và giàu dinh dưỡng nhất từ nông trại đến tận tay bạn.
                                                    Tất cả sản phẩm đều được tuyển chọn kỹ lưỡng từ các hộ nông dân uy tín, canh tác theo quy trình hữu cơ hoặc tiêu chuẩn VietGAP.
                                                </p>

                                                <p>
                                                    Với cam kết "Sạch từ tâm – Tươi mỗi ngày", chúng tôi đảm bảo rằng mỗi loại trái cây, rau củ đều được thu hoạch trong ngày, không sử dụng chất bảo quản hay thuốc hóa học độc hại.
                                                    Đặc biệt, các sản phẩm đều được kiểm tra chất lượng nghiêm ngặt trước khi đến tay khách hàng.
                                                </p>

                                                <p>
                                                    Ngoài ra, cửa hàng chúng tôi còn cung cấp thông tin chi tiết về nguồn gốc, ngày thu hoạch, hạn sử dụng và cách bảo quản cho từng sản phẩm, giúp bạn an tâm trong từng lựa chọn.
                                                    Hãy cùng chúng tôi xây dựng một thói quen sống lành mạnh, sử dụng thực phẩm sạch để bảo vệ sức khỏe cho gia đình bạn!
                                                </p>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="tab-pane fade show active" id="info" role="tabpanel">
                                        <div class="table-responsive">
                                            <table class="table info-table">
                                                <tbody>
                                                    <tr>
                                                        <td>Tên sản phẩm</td>
                                                        <td>@Model.Name</td>
                                                    </tr>
                                                    <tr>
                                                        <td>Loại</td>
                                                        <td>@Model.ProductType</td>
                                                    </tr>
                                                    <tr>
                                                        <td>Giá</td>
                                                        <td>@Model.Price.ToString("N0") VND</td>
                                                    </tr>
                                                    <tr>
                                                        <td>Số lượng còn lại</td>
                                                        <td>@Model.Quantity</td>
                                                    </tr>
                                                    @if (Model.ExpirationDate != null)
                                                    {
                                                        <tr>
                                                            <td>Hạn sử dụng</td>
                                                            <td>@Model.ExpirationDate?.ToString("dd/MM/yyyy")</td>
                                                        </tr>
                                                    }
                                                    @if (Model.ProcessingTime != null)
                                                    {
                                                        <tr>
                                                            <td>Ngày chế biến</td>
                                                            <td>@Model.ProcessingTime?.ToString("dd/MM/yyyy")</td>
                                                        </tr>
                                                    }
                                                    <tr>
                                                        <td>Danh mục</td>
                                                        <td>@Model.Category?.Name</td>
                                                    </tr>
                                                   
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>


                                   
                                   
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-xxl-3 col-xl-4 col-lg-5 d-none d-lg-block wow fadeInUp">
                    <div class="right-sidebar-box">
                        <div class="vendor-box">
                            <div class="vendor-contain">
                                <div class="vendor-image">
                                    <img src="~/images/product/vendor.png" class="blur-up lazyload" alt="">
                                </div>

                                <div class="vendor-name">
                                    <h5 class="fw-500">Noodles Co.</h5>

                                  

                                </div>
                            </div>

                            <p class="vendor-detail">
                               Fanviet là nhà cung ứng sản phẩm sạch hàng đầu 
                               được biết đến  với những sản phẩm chất lượng, sạch sẽ, đảm bảo vệ sinh an toàn
                            </p>

                            <div class="vendor-list">
                                <ul>
                                    <li>
                                        <div class="address-contact">
                                            <i data-feather="map-pin"></i>
                                            <h5>Address: <span class="text-content">FamViệt</span></h5>
                                        </div>
                                    </li>

                                    <li>
                                        <div class="address-contact">
                                            <i data-feather="headphones"></i>
                                            <h5>Contact Seller: <span class="text-content">123456789</span></h5>
                                        </div>
                                    </li>
                                </ul>
                            </div>
                        </div>

                        <!-- Trending Product -->
                        <style>
                            .product-list li {
                                transition: transform 0.2s, box-shadow 0.2s;
                            }

                                .product-list li:hover {
                                    transform: translateY(-2px);
                                    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
                                }
                            }
                        </style>

                        <h5 class="mb-3 fw-bold text-uppercase">Sản Phẩm Bán Chạy</h5>
                        <ul id="top-selling-list" class="product-list list-unstyled">
                        </ul>

                        <script>
                            async function loadTopSelling() {
                                try {
                                    const res = await fetch('/top4-selling');
                                    const products = await res.json();

                                    const list = document.getElementById('top-selling-list');
                                    list.innerHTML = '';

                                    products.forEach(p => {
                                        const item = `
                                            <li class="mb-3 d-flex align-items-center rounded p-2 shadow-sm">
                                                <a href="/shop/detail/${p.productId}" class="me-3">
                                                    <img src="${p.imageUrl}" alt="${p.productName}" class="img-thumbnail" style="width: 80px; height: 80px; object-fit: cover;" />
                                                </a>
                                                <div class="flex-grow-1">
                                                    <a href="/shop/detail/${p.productId}" class="text-dark text-decoration-none">
                                                        <h6 class="mb-1">${p.productName}</h6>
                                                    </a>
                                                    <small class="text-muted">Đã bán: <strong class="text-danger">${p.totalSold.toLocaleString()}</strong></small>
                                                </div>
                                            </li>
                                        `;
                                        list.innerHTML += item;
                                    });
                                } catch (error) {
                                    console.error('Lỗi tải sản phẩm bán chạy:', error);
                                    document.getElementById('top-selling-list').innerHTML = `<li>Không thể tải dữ liệu.</li>`;
                                }
                            }

                            window.onload = loadTopSelling;
                        </script>

                        <!-- Banner Section -->
                      
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- Product Left Sidebar End -->
    <!-- Related Product Section Start -->
 


<!-- Chi tiết sản phẩm chính tại đây -->
   
    <!-- Related Products -->
    <section class="product-list-section section-b-space">
        <div class="container-fluid-lg">
            <div class="title">
                <h2>Sản Phẩm Liên Quan</h2>
                <span class="title-leaf">
                    <svg class="icon-width">
                        <use xlink:href="~/svg/leaf.svg#leaf"></use>
                    </svg>
                </span>
            </div>
            <div class="row">
                <div class="col-12">
                    <div class="slider-6_1 product-wrapper">
                        @if (relatedProducts != null && relatedProducts.Any())
                        {
                            foreach (var product in relatedProducts)
                            {
                                var imageUrl = product.ProductImages.FirstOrDefault()?.ImageUrl ?? "/images/default.png";
                                <div class="product-box-3 wow fadeInUp">
                                    <div class="product-image">
                                        <a asp-action="Detail" asp-controller="Shop" asp-route-id="@product.Id">
                                            <img src="@imageUrl" alt="@product.Name"
                                                 class="img-fluid" style="max-height: 200px; object-fit: cover;" />
                                        </a>
                                    </div>
                                    <div class="product-footer">
                                        <div class="product-detail">
                                            <span class="span-name">@product.Category?.Name</span>
                                            <a asp-action="Detail" asp-controller="Shop" asp-route-id="@product.Id">
                                                <h5 class="name">@product.Name</h5>
                                            </a>

                                            <h6 class="unit">
                                                @if (product.ExpirationDate.HasValue)
                                                {
                                                    @($"HSD: {product.ExpirationDate.Value:dd/MM/yyyy}")
                                                }
                                                else
                                                {
                                                    <span>Không hạn</span>
                                                }
                                            </h6>

                                            <h5 class="price">
                                                <span class="theme-color">@product.Price.ToString("N0") đ</span>
                                            </h5>
                                        </div>
                                    </div>
                                </div>
                            }
                        }
                        else
                        {
                            <p>Không có sản phẩm liên quan.</p>
                        }
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- Bg overlay Start -->
    <div class="bg-overlay"></div>
    <!-- Bg overlay End -->
    <!-- latest jquery-->
    <script src="~/js/jquery-3.6.0.min.js"></script>

    <!-- jquery ui-->
    <script src="~/js/jquery-ui.min.js"></script>

    <!-- Bootstrap js-->
    <script src="~/js/bootstrap/bootstrap.bundle.min.js"></script>
    <script src="~/js/bootstrap/bootstrap-notify.min.js"></script>
    <script src="~/js/bootstrap/popper.min.js"></script>

    <!-- feather icon js-->
    <script src="~/js/feather/feather.min.js"></script>
    <script src="~/js/feather/feather-icon.js"></script>

    <!-- Lazyload Js -->
    <script src="~/js/lazysizes.min.js"></script>

    <!-- Slick js-->
    <script src="~/js/slick/slick.js"></script>
    <script src="~/js/slick/slick-animation.min.js"></script>
    <script src="~/js/custom-slick-animated.js"></script>
    <script src="~/js/slick/custom_slick.js"></script>

    <!-- Price Range Js -->
    <script src="~/js/ion.rangeSlider.min.js"></script>

    <!-- sidebar open js -->
    <script src="~/js/filter-sidebar.js"></script>

    <!-- Quantity js -->
    <script src="~/js/quantity-2.js"></script>

    <!-- Zoom Js -->
    <script src="~/js/jquery.elevatezoom.js"></script>
    <script src="~/js/zoom-filter.js"></script>

    <!-- Timer Js -->
    <script src="~/js/timer1.js"></script>

    <!-- Sticky-bar js -->
    <script src="~/js/sticky-cart-bottom.js"></script>

    <!-- WOW js -->
    <script src="~/js/wow.min.js"></script>
    <script src="~/js/custom-wow.js"></script>

    <!-- script js -->
    <script src="~/js/script.js"></script>

    <!-- theme setting js -->
    <script src="~/js/theme-setting.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const plusBtn = document.querySelector('.qty-right-plus');
            const minusBtn = document.querySelector('.qty-left-minus');
            const qtyInput = document.querySelector('.qty-input');

            plusBtn.addEventListener('click', function () {
                let value = parseInt(qtyInput.value);
                if (!isNaN(value)) {
                    qtyInput.value = value + 1;
                }
            });

            minusBtn.addEventListener('click', function () {
                let value = parseInt(qtyInput.value);
                if (!isNaN(value) && value > 1) {
                    qtyInput.value = value - 1;
                }
            });
        });
    </script>





   
    
</body>

</html>