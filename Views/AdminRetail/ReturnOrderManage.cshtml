@model List<Village_Manager.Models.ReturnOrder>

@{
    ViewData["Title"] = "Phê duyệt đơn hoàn hàng";
    Layout = "~/Views/Shared/_AdminRetail.cshtml";
}
<div class="page-wrapper compact-wrapper" id="pageWrapper">
    <div class="page-body-wrapper">
        <div class="page-body">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-sm-12">
                        <div class="card card-table">
                            <div class="card-body">
                                <form method="get" asp-action="ReturnOrderManage" class="mb-3 d-flex">
                                    <input type="text" id="searchInput" class="form-control me-2"
                                           placeholder="Tìm theo mã đơn hoặc email" value="@ViewBag.SearchTerm" />
                                    
                                </form>

                                <div class="title-header option-title d-sm-flex d-block">
                                   

                                    
                                    <table class="table table-bordered">
                                        <thead>
                                            <tr>
                                                <th>Mã đơn</th>
                                                <th>Người dùng</th>
                                                <th>Loại đơn</th>
                                                
                                                
                                                <th>Ảnh</th>
                                                <th>Ngày gửi</th>
                                                <th>Hành động</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            @foreach (var item in Model)
                                            {
                                                <tr>
                                                    <td>@item.Id</td>
                                                    <td>
                                                        @(item.User.Email)
                                                    </td>
                                                    <td>Hoàn Hàng</td>
                                                    
                                                    
                                                    <td>
                                                        @if (!string.IsNullOrEmpty(item.ImageUrl))
                                                        {
                                                            <img src="@item.ImageUrl" alt="ảnh" width="80" />
                                                        }
                                                    </td>
                                                    <td>@item.CreatedAt.ToString("dd/MM/yyyy HH:mm")</td>
                                                    <td>
                                                        <div class="d-flex gap-2">
                                                            <form method="post" asp-action="Approve" asp-route-id="@item.Id">
                                                                <button type="submit" class="btn btn-success btn-sm"
                                                                        onclick="return confirm('Bạn có chắc chắn muốn phê duyệt đơn hàng của @item.User.Email không?');">
                                                                    Phê duyệt
                                                                </button>
                                                            </form>

                                                            <form method="post" asp-action="Reject" asp-route-id="@item.Id">
                                                                <button type="submit" class="btn btn-danger btn-sm"
                                                                        onclick="return confirm('Bạn có chắc chắn muốn từ chối đơn hàng của @item.User.Email không?');">
                                                                    Từ chối
                                                                </button>
                                                            </form>

                                                            <a asp-action="ReturnOrderDetails" asp-route-id="@item.Id" class="btn btn-primary btn-sm">
                                                                Chi tiết
                                                            </a>
                                                        </div>


                                                    </td>
                                                </tr>
                                            }
                                        </tbody>
                                    </table>
                                    @if (ViewBag.TotalPages > 1)
                                    {
                                        <nav>
                                            <ul class="pagination">
                                                @for (int i = 1; i <= ViewBag.TotalPages; i++)
                                                {
                                                    <li class="page-item @(i == ViewBag.CurrentPage ? "active" : "")">
                                                        <a class="page-link" asp-action="ReturnOrderManage"
                                                           asp-route-page="@i"
                                                           asp-route-searchTerm="@ViewBag.SearchTerm">
                                                            @i
                                                        </a>
                                                    </li>
                                                }
                                            </ul>
                                        </nav>
                                    }
                                </div>

                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
@section Scripts {
            <script>
                let typingTimer;
                const input = document.getElementById("searchInput");

                input.addEventListener("input", function () {
                    clearTimeout(typingTimer);
                    typingTimer = setTimeout(() => {
                        const searchTerm = input.value.trim();
                        const url = new URL(window.location.href);
                        url.searchParams.set("searchTerm", searchTerm);
                        url.searchParams.set("page", 1); // reset về trang 1 khi tìm kiếm
                        window.location.href = url.toString();
                    }, 2000); // Delay sau khi gõ xong
                });
            </script>
}
